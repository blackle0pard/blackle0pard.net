Title:     yayコマンドでアップデート出来ない / There may be another Pacman instance running  
Date:      2021-09-27 22:38  
Category:  Tech  
Tags:	   ArchLinux    
Slug:	   96zbo7  
Author:    blackle0pard  

- yayコマンドでアップデートすると、下記のように待機の状態になりました。   

```
$ yay -Syu --noconfirm
 -> /var/lib/pacman/db.lck is present.
 -> There may be another Pacman instance running. Waiting...
```

- メッセージの通り、ロックファイルがありました。  

```
$ ls -l /var/lib/pacman/db.lck 
---------- 1 root root 0 Sep 26 19:50 /var/lib/pacman/db.lck
```

- (失敗するのは分かっていますが、)pacmanコマンドでもアップデートに失敗します。  

```
$ sudo pacman -Syu --noconfirm
:: Synchronizing package databases...
error: failed to synchronize all databases (unable to lock database)
```

- エラーの対処方法はArchWikiに書いてある通りで、ロックファイルを削除します。    
    - ["Failed to init transaction (unable to lock database)" error](https://wiki.archlinux.org/title/pacman#%22Failed_to_init_transaction_(unable_to_lock_database)%22_error)

```
$ sudo rm /var/lib/pacman/db.lck 
```

- ファイルの削除後、無事にアップデート出来ました。  

```
$ yay -Syu --noconfirm
:: Synchronizing package databases...
 core                            137.3 KiB   974 KiB/s 00:00 [################################] 100%
 extra                          1567.0 KiB  6.96 MiB/s 00:00 [################################] 100%
 community                         5.8 MiB  29.0 MiB/s 00:00 [################################] 100%
:: Starting full system upgrade...
resolving dependencies...
looking for conflicting packages...

...

:: Running post-transaction hooks...
(1/1) Arming ConditionNeedsUpdate...
:: Searching databases for updates...
:: Searching AUR for updates...
 there is nothing to do
```
