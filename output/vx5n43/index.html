<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>【自分用】ArchLinuxのインストール手順 (2021年12月) - くろひょうのぶろぐ</title>
  <meta name="author" content="blackle0pard">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/hack-font/3.3.0/web/hack.min.css">
  <link rel="stylesheet" type="text/css" href="https://blackle0pard.net/theme/css/style.css">

</head>

<body>
  <div class="container">
    <section class="header">
      <h2 class="title"><a href="https://blackle0pard.net/">くろひょうのぶろぐ</a></h2>
    </section>

<div class="article-title">【自分用】ArchLinuxのインストール手順 (2021年12月)</div>
<div class="article-published" datetime="2021-12-11T21:36:00+09:00"><span class="mgl-10">2021-12-11 21:36</span>
</div>
<div class="article">
  <p><a href="https://www.vultr.com/">Vultr</a>にArchLinuxをインストールするための、自分用メモ。正しいインストール手順は、<a href="https://wiki.archlinux.org/title/Installation_guide">Installation guide - ArchWiki</a> を参照してください。</p>
<h1>ISOイメージの準備</h1>
<ul>
<li>Vultrでは自分で用意したISOイメージを使ってOSをインストールすることができます。  <ul>
<li><a href="https://www.vultr.com/docs/requirements-for-uploading-an-os-iso-to-vultr">How to Upload Custom ISOs to Vultr - Vultr.com</a>  </li>
</ul>
</li>
<li><a href="https://www.vultr.com/news/Introducing-The-ISO-Library/">ISO Library</a>の中にArchLinuxが用意されていますが、今回は自分で用意したISOイメージ(archlinux-2021.12.01-x86_64.iso)を使いました。  </li>
<li>ArchLinuxのISOイメージ (日本のサーバー)  <ul>
<li><a href="https://mirrors.cat.net/archlinux/">cat.net</a>  </li>
<li><a href="http://ftp.jaist.ac.jp/pub/Linux/ArchLinux/">jaist.ac.jp</a>  </li>
<li><a href="http://ftp.tsukuba.wide.ad.jp/Linux/archlinux/">tsukuba.wide.ad.jp</a>  </li>
<li>最新の情報は、<a href="https://www.archlinux.jp/download/">Arch Linux JP Project - ダウンロード</a>で確認。  </li>
</ul>
</li>
</ul>
<h1>SSHログインの準備</h1>
<ul>
<li>準備したISOイメージで起動後、SSHでログイン出来るように設定変更します。</li>
<li>rootユーザーのパスワードを設定します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># passwd</span>
<span class="err">New password: &lt;Password&gt;</span>
<span class="err">Retype new password: &lt;Password&gt;</span>
</code></pre></div>

<h1>インストール</h1>
<ul>
<li>SSHでログインすると、下記のように表示されます。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c">% ssh root@***.***.***.***</span>
<span class="n">Warning</span><span class="p">:</span> <span class="n">Permanently</span> <span class="n">added</span> <span class="s">&#39;***.***.***.***&#39;</span> <span class="p">(</span><span class="n">ED25519</span><span class="p">)</span> <span class="n">to</span> <span class="n">the</span> <span class="n">list</span> <span class="n">of</span> <span class="n">known</span> <span class="n">hosts</span><span class="p">.</span>
<span class="p">(</span><span class="n">root</span><span class="p">@</span><span class="o">***.***.***.***</span><span class="p">)</span> <span class="n">Password</span><span class="p">:</span> 
<span class="n">To</span> <span class="s">install</span> <span class="s">Arch</span> <span class="s">Linux</span> <span class="s">follow</span> <span class="s">the</span> <span class="s">installation</span> <span class="s">guide:</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">wiki</span><span class="p">.</span><span class="n">archlinux</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">title</span><span class="o">/</span><span class="n">Installation_guide</span>

<span class="n">For</span> <span class="s">Wi-Fi,</span> <span class="s">authenticate</span> <span class="s">to</span> <span class="s">the</span> <span class="s">wireless</span> <span class="s">network</span> <span class="s">using</span> <span class="s">the</span> <span class="s">iwctl</span> <span class="s">utility.</span>
<span class="n">For</span> <span class="s">mobile</span> <span class="s">broadband</span> <span class="s">(WWAN)</span> <span class="s">modems,</span> <span class="s">connect</span> <span class="s">with</span> <span class="s">the</span> <span class="s">mmcli</span> <span class="s">utility.</span>
<span class="n">Ethernet</span><span class="p">,</span> <span class="n">WLAN</span> <span class="n">and</span> <span class="n">WWAN</span> <span class="n">interfaces</span> <span class="n">using</span> <span class="n">DHCP</span> <span class="n">should</span> <span class="n">work</span> <span class="n">automatically</span><span class="p">.</span>

<span class="n">After</span> <span class="s">connecting</span> <span class="s">to</span> <span class="s">the</span> <span class="s">internet,</span> <span class="s">the</span> <span class="s">installation</span> <span class="s">guide</span> <span class="s">can</span> <span class="s">be</span> <span class="s">accessed</span>
<span class="n">via</span> <span class="s">the</span> <span class="s">convenience</span> <span class="s">script</span> <span class="s">Installation_guide.</span>

<span class="n">Last</span> <span class="s">login:</span> <span class="s">Sat</span> <span class="s">Dec</span> <span class="s">11</span> <span class="s">07:44:46</span> <span class="s">2021</span>
# 
</code></pre></div>

<ul>
<li>サーバーの環境を確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># uname -srvmo</span>
<span class="err">Linux 5.15.5-arch1-1 #1 SMP PREEMPT Thu, 25 Nov 2021 22:09:33 +0000 x86_64 GNU/Linux</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err"># cat /etc/os-release </span>
<span class="err">NAME=&quot;Arch Linux&quot;</span>
<span class="err">PRETTY_NAME=&quot;Arch Linux&quot;</span>
<span class="err">ID=arch</span>
<span class="err">BUILD_ID=rolling</span>
<span class="err">ANSI_COLOR=&quot;38;2;23;147;209&quot;</span>
<span class="err">HOME_URL=&quot;https://archlinux.org/&quot;</span>
<span class="err">DOCUMENTATION_URL=&quot;https://wiki.archlinux.org/&quot;</span>
<span class="err">SUPPORT_URL=&quot;https://bbs.archlinux.org/&quot;</span>
<span class="err">BUG_REPORT_URL=&quot;https://bugs.archlinux.org/&quot;</span>
<span class="err">LOGO=archlinux-logo</span>
<span class="err">IMAGE_ID=archlinux</span>
<span class="err">IMAGE_VERSION=2021.12.01</span>
</code></pre></div>

<ul>
<li>キーボードのレイアウトを確認します(自分は日本語キーボードを使っているので、jpでgrepしています)。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err">ls /usr/share/kbd/keymaps/**/*.map.gz | grep jp</span>
<span class="err">/usr/share/kbd/keymaps/i386/qwerty/jp106.map.gz</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err"># localectl list-keymaps| grep jp</span>
<span class="err">jp106</span>
</code></pre></div>

<ul>
<li>日本語キーボードのレイアウトに変更します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># loadkeys jp106</span>
</code></pre></div>

<ul>
<li>boot modeを確認します。<a href="https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface#UEFI_variables">efivars ディレクトリ</a> がないので、BIOS modeで動いていると判断します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err">#  ls /sys/firmware/efi/efivars</span>
<span class="c">ls: cannot access &#39;/sys/firmware/efi/efivars&#39;: No such file or directory</span>
</code></pre></div>

<ul>
<li>ネットワークを確認します。通常、NWインタフェースは1つのみですが、<a href="https://www.vultr.com/ja/features/advanced-networking/">Private Network</a>を追加していると、2つ以上接続されている場合があります。    </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># ip link</span>
<span class="c">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span>
<span class="c">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span>
<span class="c">2: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000</span>
<span class="c">    link/ether **:**:**:**:**:** brd ff:ff:ff:ff:ff:ff</span>
<span class="c">3: enp6s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc mq state UP mode DEFAULT group default qlen 1000</span>
<span class="c">    link/ether **:**:**:**:**:** brd ff:ff:ff:ff:ff:ff</span>
</code></pre></div>

<ul>
<li>システムクロックの同期状態を確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># timedatectl status</span>
<span class="err">               Local time: Sat 2021-12-11 07:50:53 UTC</span>
<span class="err">           Universal time: Sat 2021-12-11 07:50:53 UTC</span>
<span class="err">                 RTC time: Sat 2021-12-11 07:50:54</span>
<span class="err">                Time zone: UTC (UTC, +0000)</span>
<span class="err">System clock synchronized: no</span>
<span class="err">              NTP service: inactive</span>
<span class="err">          RTC in local TZ: no</span>
</code></pre></div>

<ul>
<li>システムクロックの同期を有効化します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># timedatectl set-ntp true</span>
</code></pre></div>

<ul>
<li>システムクロックの同期状態を確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># timedatectl status</span>
<span class="err">               Local time: Sat 2021-12-11 07:51:25 UTC</span>
<span class="err">           Universal time: Sat 2021-12-11 07:51:25 UTC</span>
<span class="err">                 RTC time: Sat 2021-12-11 07:51:25</span>
<span class="err">                Time zone: UTC (UTC, +0000)</span>
<span class="err">System clock synchronized: yes</span>
<span class="err">              NTP service: active</span>
<span class="err">          RTC in local TZ: no</span>
</code></pre></div>

<ul>
<li>パーティションテーブルを一覧表示します (パーティションを作成するデバイスは<code>/dev/vda</code>であることを確認)。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">fdisk</span> <span class="o">-</span><span class="n">l</span>
<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span><span class="p">:</span> <span class="mi">25</span> <span class="n">GiB</span><span class="p">,</span> <span class="mi">26843545600</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">52428800</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>


<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span><span class="p">:</span> <span class="mi">701</span><span class="p">.</span><span class="mi">33</span> <span class="n">MiB</span><span class="p">,</span> <span class="mi">735399936</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">1436328</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
</code></pre></div>

<ul>
<li>パーティションを作成します。今回は、Swap 1GB。それ以外はrootディレクトリにします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">fdisk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span> 

<span class="n">Welcome</span> <span class="k">to</span> <span class="n">fdisk</span> <span class="p">(</span><span class="n">util</span><span class="o">-</span><span class="n">linux</span> <span class="mi">2</span><span class="p">.</span><span class="mi">37</span><span class="p">.</span><span class="mi">2</span><span class="p">).</span>
<span class="n">Changes</span> <span class="n">will</span> <span class="n">remain</span> <span class="k">in</span> <span class="n">memory</span> <span class="k">only</span><span class="p">,</span> <span class="k">until</span> <span class="n">you</span> <span class="n">decide</span> <span class="k">to</span> <span class="k">write</span> <span class="n">them</span><span class="p">.</span>
<span class="n">Be</span> <span class="n">careful</span> <span class="k">before</span> <span class="k">using</span> <span class="n">the</span> <span class="k">write</span> <span class="n">command</span><span class="p">.</span>

<span class="n">Device</span> <span class="n">does</span> <span class="k">not</span> <span class="n">contain</span> <span class="n">a</span> <span class="n">recognized</span> <span class="n">partition</span> <span class="k">table</span><span class="p">.</span>
<span class="n">Created</span> <span class="n">a</span> <span class="k">new</span> <span class="n">DOS</span> <span class="n">disklabel</span> <span class="k">with</span> <span class="n">disk</span> <span class="n">identifier</span> <span class="mi">0</span><span class="n">x0b9a45d3</span><span class="p">.</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">p</span>
<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span><span class="p">:</span> <span class="mi">25</span> <span class="n">GiB</span><span class="p">,</span> <span class="mi">26843545600</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">52428800</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Disklabel</span> <span class="k">type</span><span class="p">:</span> <span class="n">dos</span>
<span class="n">Disk</span> <span class="n">identifier</span><span class="p">:</span> <span class="mi">0</span><span class="n">x0b9a45d3</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">n</span>
<span class="n">Partition</span> <span class="k">type</span>
   <span class="n">p</span>   <span class="k">primary</span> <span class="p">(</span><span class="mi">0</span> <span class="k">primary</span><span class="p">,</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">,</span> <span class="mi">4</span> <span class="k">free</span><span class="p">)</span>
   <span class="n">e</span>   <span class="n">extended</span> <span class="p">(</span><span class="n">container</span> <span class="k">for</span> <span class="n">logical</span> <span class="n">partitions</span><span class="p">)</span>
<span class="k">Select</span> <span class="p">(</span><span class="k">default</span> <span class="n">p</span><span class="p">):</span> <span class="n">p</span>
<span class="n">Partition</span> <span class="nb">number</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="k">default</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">1</span>
<span class="k">First</span> <span class="n">sector</span> <span class="p">(</span><span class="mi">2048</span><span class="o">-</span><span class="mi">52428799</span><span class="p">,</span> <span class="k">default</span> <span class="mi">2048</span><span class="p">):</span> 
<span class="k">Last</span> <span class="n">sector</span><span class="p">,</span> <span class="o">+/-</span><span class="n">sectors</span> <span class="k">or</span> <span class="o">+/-</span><span class="k">size</span><span class="err">{</span><span class="n">K</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="k">G</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">P</span><span class="err">}</span> <span class="p">(</span><span class="mi">2048</span><span class="o">-</span><span class="mi">52428799</span><span class="p">,</span> <span class="k">default</span> <span class="mi">52428799</span><span class="p">):</span> <span class="o">+</span><span class="mi">1</span><span class="k">G</span>

<span class="n">Created</span> <span class="n">a</span> <span class="k">new</span> <span class="n">partition</span> <span class="mi">1</span> <span class="k">of</span> <span class="k">type</span> <span class="s1">&#39;Linux&#39;</span> <span class="k">and</span> <span class="k">of</span> <span class="k">size</span> <span class="mi">1</span> <span class="n">GiB</span><span class="p">.</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">p</span>
<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span><span class="p">:</span> <span class="mi">25</span> <span class="n">GiB</span><span class="p">,</span> <span class="mi">26843545600</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">52428800</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Disklabel</span> <span class="k">type</span><span class="p">:</span> <span class="n">dos</span>
<span class="n">Disk</span> <span class="n">identifier</span><span class="p">:</span> <span class="mi">0</span><span class="n">x0b9a45d3</span>

<span class="n">Device</span>     <span class="n">Boot</span> <span class="k">Start</span>     <span class="k">End</span> <span class="n">Sectors</span> <span class="k">Size</span> <span class="n">Id</span> <span class="k">Type</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda1</span>        <span class="mi">2048</span> <span class="mi">2099199</span> <span class="mi">2097152</span>   <span class="mi">1</span><span class="k">G</span> <span class="mi">83</span> <span class="n">Linux</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">t</span>
<span class="n">Selected</span> <span class="n">partition</span> <span class="mi">1</span>
<span class="n">Hex</span> <span class="n">code</span> <span class="k">or</span> <span class="k">alias</span> <span class="p">(</span><span class="k">type</span> <span class="n">L</span> <span class="k">to</span> <span class="n">list</span> <span class="k">all</span><span class="p">):</span> <span class="mi">82</span>
<span class="n">Changed</span> <span class="k">type</span> <span class="k">of</span> <span class="n">partition</span> <span class="s1">&#39;Linux&#39;</span> <span class="k">to</span> <span class="s1">&#39;Linux swap / Solaris&#39;</span><span class="p">.</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">p</span>
<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span><span class="p">:</span> <span class="mi">25</span> <span class="n">GiB</span><span class="p">,</span> <span class="mi">26843545600</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">52428800</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Disklabel</span> <span class="k">type</span><span class="p">:</span> <span class="n">dos</span>
<span class="n">Disk</span> <span class="n">identifier</span><span class="p">:</span> <span class="mi">0</span><span class="n">x0b9a45d3</span>

<span class="n">Device</span>     <span class="n">Boot</span> <span class="k">Start</span>     <span class="k">End</span> <span class="n">Sectors</span> <span class="k">Size</span> <span class="n">Id</span> <span class="k">Type</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda1</span>        <span class="mi">2048</span> <span class="mi">2099199</span> <span class="mi">2097152</span>   <span class="mi">1</span><span class="k">G</span> <span class="mi">82</span> <span class="n">Linux</span> <span class="n">swap</span> <span class="o">/</span> <span class="n">Solaris</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">n</span>
<span class="n">Partition</span> <span class="k">type</span>
   <span class="n">p</span>   <span class="k">primary</span> <span class="p">(</span><span class="mi">1</span> <span class="k">primary</span><span class="p">,</span> <span class="mi">0</span> <span class="n">extended</span><span class="p">,</span> <span class="mi">3</span> <span class="k">free</span><span class="p">)</span>
   <span class="n">e</span>   <span class="n">extended</span> <span class="p">(</span><span class="n">container</span> <span class="k">for</span> <span class="n">logical</span> <span class="n">partitions</span><span class="p">)</span>
<span class="k">Select</span> <span class="p">(</span><span class="k">default</span> <span class="n">p</span><span class="p">):</span> <span class="n">p</span>
<span class="n">Partition</span> <span class="nb">number</span> <span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="k">default</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">2</span>
<span class="k">First</span> <span class="n">sector</span> <span class="p">(</span><span class="mi">2099200</span><span class="o">-</span><span class="mi">52428799</span><span class="p">,</span> <span class="k">default</span> <span class="mi">2099200</span><span class="p">):</span> 
<span class="k">Last</span> <span class="n">sector</span><span class="p">,</span> <span class="o">+/-</span><span class="n">sectors</span> <span class="k">or</span> <span class="o">+/-</span><span class="k">size</span><span class="err">{</span><span class="n">K</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="k">G</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">P</span><span class="err">}</span> <span class="p">(</span><span class="mi">2099200</span><span class="o">-</span><span class="mi">52428799</span><span class="p">,</span> <span class="k">default</span> <span class="mi">52428799</span><span class="p">):</span> 

<span class="n">Created</span> <span class="n">a</span> <span class="k">new</span> <span class="n">partition</span> <span class="mi">2</span> <span class="k">of</span> <span class="k">type</span> <span class="s1">&#39;Linux&#39;</span> <span class="k">and</span> <span class="k">of</span> <span class="k">size</span> <span class="mi">24</span> <span class="n">GiB</span><span class="p">.</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">p</span>
<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span><span class="p">:</span> <span class="mi">25</span> <span class="n">GiB</span><span class="p">,</span> <span class="mi">26843545600</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">52428800</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Disklabel</span> <span class="k">type</span><span class="p">:</span> <span class="n">dos</span>
<span class="n">Disk</span> <span class="n">identifier</span><span class="p">:</span> <span class="mi">0</span><span class="n">x0b9a45d3</span>

<span class="n">Device</span>     <span class="n">Boot</span>   <span class="k">Start</span>      <span class="k">End</span>  <span class="n">Sectors</span> <span class="k">Size</span> <span class="n">Id</span> <span class="k">Type</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda1</span>          <span class="mi">2048</span>  <span class="mi">2099199</span>  <span class="mi">2097152</span>   <span class="mi">1</span><span class="k">G</span> <span class="mi">82</span> <span class="n">Linux</span> <span class="n">swap</span> <span class="o">/</span> <span class="n">Solaris</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda2</span>       <span class="mi">2099200</span> <span class="mi">52428799</span> <span class="mi">50329600</span>  <span class="mi">24</span><span class="k">G</span> <span class="mi">83</span> <span class="n">Linux</span>

<span class="n">Command</span> <span class="p">(</span><span class="n">m</span> <span class="k">for</span> <span class="n">help</span><span class="p">):</span> <span class="n">w</span>
<span class="n">The</span> <span class="n">partition</span> <span class="k">table</span> <span class="n">has</span> <span class="n">been</span> <span class="n">altered</span><span class="p">.</span>
<span class="n">Calling</span> <span class="n">ioctl</span><span class="p">()</span> <span class="k">to</span> <span class="n">re</span><span class="o">-</span><span class="k">read</span> <span class="n">partition</span> <span class="k">table</span><span class="p">.</span>
<span class="n">Syncing</span> <span class="n">disks</span><span class="p">.</span>
</code></pre></div>

<ul>
<li>パーティションテーブルを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">fdisk</span> <span class="o">-</span><span class="n">l</span>        
<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda</span><span class="p">:</span> <span class="mi">25</span> <span class="n">GiB</span><span class="p">,</span> <span class="mi">26843545600</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">52428800</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Disklabel</span> <span class="k">type</span><span class="p">:</span> <span class="n">dos</span>
<span class="n">Disk</span> <span class="n">identifier</span><span class="p">:</span> <span class="mi">0</span><span class="n">x0b9a45d3</span>

<span class="n">Device</span>     <span class="n">Boot</span>   <span class="k">Start</span>      <span class="k">End</span>  <span class="n">Sectors</span> <span class="k">Size</span> <span class="n">Id</span> <span class="k">Type</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda1</span>          <span class="mi">2048</span>  <span class="mi">2099199</span>  <span class="mi">2097152</span>   <span class="mi">1</span><span class="k">G</span> <span class="mi">82</span> <span class="n">Linux</span> <span class="n">swap</span> <span class="o">/</span> <span class="n">Solaris</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda2</span>       <span class="mi">2099200</span> <span class="mi">52428799</span> <span class="mi">50329600</span>  <span class="mi">24</span><span class="k">G</span> <span class="mi">83</span> <span class="n">Linux</span>


<span class="n">Disk</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">loop0</span><span class="p">:</span> <span class="mi">701</span><span class="p">.</span><span class="mi">33</span> <span class="n">MiB</span><span class="p">,</span> <span class="mi">735399936</span> <span class="n">bytes</span><span class="p">,</span> <span class="mi">1436328</span> <span class="n">sectors</span>
<span class="n">Units</span><span class="p">:</span> <span class="n">sectors</span> <span class="k">of</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">512</span> <span class="o">=</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">Sector</span> <span class="k">size</span> <span class="p">(</span><span class="n">logical</span><span class="o">/</span><span class="n">physical</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
<span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="k">size</span> <span class="p">(</span><span class="n">minimum</span><span class="o">/</span><span class="n">optimal</span><span class="p">):</span> <span class="mi">512</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">512</span> <span class="n">bytes</span>
</code></pre></div>

<ul>
<li>メモリの状態を確認します(この時点で、swapはない)。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># free -h </span>
<span class="err">               total        used        free      shared  buff/cache   available</span>
<span class="c">Mem:           970Mi       122Mi       286Mi       174Mi       560Mi       534Mi</span>
<span class="c">Swap:             0B          0B          0B</span>
</code></pre></div>

<ul>
<li>swapパーティションを作成します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># mkswap /dev/vda1 </span>
<span class="err">Setting up swapspace version 1, size = 1024 MiB (1073737728 bytes)</span>
<span class="err">no label, UUID=4ce8ea7b-5c2a-4df6-85d8-8b7b597acf1a</span>
</code></pre></div>

<ul>
<li>初期化します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># swapon /dev/vda1 </span>
</code></pre></div>

<ul>
<li>swapパーティションが作成されたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># free -h</span>
<span class="err">               total        used        free      shared  buff/cache   available</span>
<span class="c">Mem:           970Mi       122Mi       286Mi       174Mi       561Mi       535Mi</span>
<span class="c">Swap:          1.0Gi          0B       1.0Gi</span>
</code></pre></div>

<ul>
<li>Ext4でパーティションを作成します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">mkfs</span><span class="p">.</span><span class="n">ext4</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda2</span>
<span class="n">mke2fs</span> <span class="mi">1</span><span class="p">.</span><span class="mi">46</span><span class="p">.</span><span class="mi">4</span> <span class="p">(</span><span class="mi">18</span><span class="o">-</span><span class="n">Aug</span><span class="o">-</span><span class="mi">2021</span><span class="p">)</span>
<span class="n">Discarding</span> <span class="n">device</span> <span class="n">blocks</span><span class="p">:</span> <span class="n">done</span>                            
<span class="n">Creating</span> <span class="n">filesystem</span> <span class="k">with</span> <span class="mi">6291200</span> <span class="mi">4</span><span class="n">k</span> <span class="n">blocks</span> <span class="k">and</span> <span class="mi">1572864</span> <span class="n">inodes</span>
<span class="n">Filesystem</span> <span class="n">UUID</span><span class="p">:</span> <span class="n">d01cd335</span><span class="o">-</span><span class="mi">604</span><span class="n">a</span><span class="o">-</span><span class="mi">4</span><span class="n">fe3</span><span class="o">-</span><span class="n">a27f</span><span class="o">-</span><span class="n">e97666d5b666</span>
<span class="n">Superblock</span> <span class="n">backups</span> <span class="n">stored</span> <span class="k">on</span> <span class="n">blocks</span><span class="p">:</span> 
    <span class="mi">32768</span><span class="p">,</span> <span class="mi">98304</span><span class="p">,</span> <span class="mi">163840</span><span class="p">,</span> <span class="mi">229376</span><span class="p">,</span> <span class="mi">294912</span><span class="p">,</span> <span class="mi">819200</span><span class="p">,</span> <span class="mi">884736</span><span class="p">,</span> <span class="mi">1605632</span><span class="p">,</span> <span class="mi">2654208</span><span class="p">,</span> 
    <span class="mi">4096000</span>

<span class="n">Allocating</span> <span class="k">group</span> <span class="n">tables</span><span class="p">:</span> <span class="n">done</span>                            
<span class="n">Writing</span> <span class="n">inode</span> <span class="n">tables</span><span class="p">:</span> <span class="n">done</span>                            
<span class="n">Creating</span> <span class="n">journal</span> <span class="p">(</span><span class="mi">32768</span> <span class="n">blocks</span><span class="p">):</span> <span class="n">done</span>
<span class="n">Writing</span> <span class="n">superblocks</span> <span class="k">and</span> <span class="n">filesystem</span> <span class="n">accounting</span> <span class="n">information</span><span class="p">:</span> <span class="n">done</span>   
</code></pre></div>

<ul>
<li>現在、マウントされているディレクトリを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># df -h</span>
<span class="err">Filesystem      Size  Used Avail Use% Mounted on</span>
<span class="err">dev             452M     0  452M   0% /dev</span>
<span class="err">run             486M  166M  320M  35% /run</span>
<span class="err">/dev/sr0        851M  851M     0 100% /run/archiso/bootmnt</span>
<span class="err">cowspace        256M  4.1M  252M   2% /run/archiso/cowspace</span>
<span class="err">/dev/loop0      702M  702M     0 100% /run/archiso/airootfs</span>
<span class="err">airootfs        256M  4.1M  252M   2% /</span>
<span class="err">tmpfs           486M     0  486M   0% /dev/shm</span>
<span class="err">tmpfs           486M     0  486M   0% /tmp</span>
<span class="err">tmpfs           486M  2.2M  484M   1% /etc/pacman.d/gnupg</span>
<span class="err">tmpfs            98M     0   98M   0% /run/user/0</span>
</code></pre></div>

<ul>
<li>ISOイメージを/mnt ディレクトリにマウントします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># mount /dev/vda2 /mnt </span>
</code></pre></div>

<ul>
<li>ISOイメージが/mnt ディレクトリにマウントされたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># df -h                </span>
<span class="err">Filesystem      Size  Used Avail Use% Mounted on</span>
<span class="err">dev             452M     0  452M   0% /dev</span>
<span class="err">run             486M  166M  320M  35% /run</span>
<span class="err">/dev/sr0        851M  851M     0 100% /run/archiso/bootmnt</span>
<span class="err">cowspace        256M  4.1M  252M   2% /run/archiso/cowspace</span>
<span class="err">/dev/loop0      702M  702M     0 100% /run/archiso/airootfs</span>
<span class="err">airootfs        256M  4.1M  252M   2% /</span>
<span class="err">tmpfs           486M     0  486M   0% /dev/shm</span>
<span class="err">tmpfs           486M     0  486M   0% /tmp</span>
<span class="err">tmpfs           486M  2.2M  484M   1% /etc/pacman.d/gnupg</span>
<span class="err">tmpfs            98M     0   98M   0% /run/user/0</span>
<span class="err">/dev/vda2        24G   24K   23G   1% /mnt</span>
</code></pre></div>

<ul>
<li>pacmanのパッケージリストを修正します(既存の参照先は全て削除して、新しく追加します)。参照先は下記のサイトから確認。    <ul>
<li><a href="https://archlinux.org/mirrorlist/">Arch Linux - Pacman Mirrorlist Generator</a>  </li>
<li><a href="https://archlinux.org/mirrorlist/?country=JP&amp;protocol=http&amp;protocol=https&amp;ip_version=4&amp;use_mirror_status=on">https://archlinux.org/mirrorlist/?country=JP&amp;protocol=http&amp;protocol=https&amp;ip_version=4&amp;use_mirror_status=on</a></li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># vim /etc/pacman.d/mirrorlist </span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pacman</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="n">mirrorlist</span> 
<span class="o">#</span>
<span class="o">#</span> <span class="n">Arch</span> <span class="n">Linux</span> <span class="n">repository</span> <span class="n">mirrorlist</span>
<span class="o">#</span> <span class="n">Filtered</span> <span class="k">by</span> <span class="n">mirror</span> <span class="n">score</span> <span class="k">from</span> <span class="n">mirror</span> <span class="n">status</span> <span class="n">page</span>
<span class="o">#</span> <span class="k">Generated</span> <span class="k">on</span> <span class="mi">2021</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">11</span>
<span class="o">#</span>

<span class="o">#</span> <span class="n">Japan</span>
<span class="n">Server</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">net</span><span class="o">/</span><span class="n">archlinux</span><span class="o">/</span><span class="err">$</span><span class="n">repo</span><span class="o">/</span><span class="n">os</span><span class="o">/</span><span class="err">$</span><span class="n">arch</span>
<span class="o">#</span> <span class="n">Japan</span>
<span class="n">Server</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ftp</span><span class="p">.</span><span class="n">tsukuba</span><span class="p">.</span><span class="n">wide</span><span class="p">.</span><span class="n">ad</span><span class="p">.</span><span class="n">jp</span><span class="o">/</span><span class="n">Linux</span><span class="o">/</span><span class="n">archlinux</span><span class="o">/</span><span class="err">$</span><span class="n">repo</span><span class="o">/</span><span class="n">os</span><span class="o">/</span><span class="err">$</span><span class="n">arch</span>
<span class="o">#</span> <span class="n">Japan</span>
<span class="n">Server</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ftp</span><span class="p">.</span><span class="n">jaist</span><span class="p">.</span><span class="n">ac</span><span class="p">.</span><span class="n">jp</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">Linux</span><span class="o">/</span><span class="n">ArchLinux</span><span class="o">/</span><span class="err">$</span><span class="n">repo</span><span class="o">/</span><span class="n">os</span><span class="o">/</span><span class="err">$</span><span class="n">arch</span>
<span class="o">#</span> <span class="n">Japan</span>
<span class="n">Server</span> <span class="o">=</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="p">.</span><span class="n">cat</span><span class="p">.</span><span class="n">net</span><span class="o">/</span><span class="n">archlinux</span><span class="o">/</span><span class="err">$</span><span class="n">repo</span><span class="o">/</span><span class="n">os</span><span class="o">/</span><span class="err">$</span><span class="n">arch</span>
<span class="o">#</span> <span class="n">Japan</span>
<span class="n">Server</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ftp</span><span class="p">.</span><span class="n">jaist</span><span class="p">.</span><span class="n">ac</span><span class="p">.</span><span class="n">jp</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">Linux</span><span class="o">/</span><span class="n">ArchLinux</span><span class="o">/</span><span class="err">$</span><span class="n">repo</span><span class="o">/</span><span class="n">os</span><span class="o">/</span><span class="err">$</span><span class="n">arch</span>
</code></pre></div>

<ul>
<li>必須パッケージをインストールします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># pacstrap /mnt base linux-lts linux-firmware</span>
</code></pre></div>

<h1>システム設定</h1>
<ul>
<li>fstabの設定を確認します(何も設定が入っていないはず)。</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab</span>
<span class="o">#</span> <span class="k">Static</span> <span class="n">information</span> <span class="n">about</span> <span class="n">the</span> <span class="n">filesystems</span><span class="p">.</span>
<span class="o">#</span> <span class="n">See</span> <span class="n">fstab</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">details</span><span class="p">.</span>

<span class="o">#</span> <span class="o">&lt;</span><span class="n">file</span> <span class="k">system</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="k">type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="k">options</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dump</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">pass</span><span class="o">&gt;</span>
</code></pre></div>

<ul>
<li>fstabを修正します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># genfstab -U /mnt &gt;&gt; /mnt/etc/fstab</span>
</code></pre></div>

<ul>
<li>設定が追加されたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="n">cat</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">fstab</span>                
<span class="o">#</span> <span class="k">Static</span> <span class="n">information</span> <span class="n">about</span> <span class="n">the</span> <span class="n">filesystems</span><span class="p">.</span>
<span class="o">#</span> <span class="n">See</span> <span class="n">fstab</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">details</span><span class="p">.</span>

<span class="o">#</span> <span class="o">&lt;</span><span class="n">file</span> <span class="k">system</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="k">type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="k">options</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dump</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">pass</span><span class="o">&gt;</span>
<span class="o">#</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda2</span>
<span class="n">UUID</span><span class="o">=</span><span class="n">d01cd335</span><span class="o">-</span><span class="mi">604</span><span class="n">a</span><span class="o">-</span><span class="mi">4</span><span class="n">fe3</span><span class="o">-</span><span class="n">a27f</span><span class="o">-</span><span class="n">e97666d5b666</span>   <span class="o">/</span>           <span class="n">ext4</span>        <span class="n">rw</span><span class="p">,</span><span class="n">relatime</span> <span class="mi">0</span> <span class="mi">1</span>

<span class="o">#</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">vda1</span>
<span class="n">UUID</span><span class="o">=</span><span class="mi">4</span><span class="n">ce8ea7b</span><span class="o">-</span><span class="mi">5</span><span class="n">c2a</span><span class="o">-</span><span class="mi">4</span><span class="n">df6</span><span class="o">-</span><span class="mi">85</span><span class="n">d8</span><span class="o">-</span><span class="mi">8</span><span class="n">b7b597acf1a</span>   <span class="k">none</span>        <span class="n">swap</span>        <span class="k">defaults</span>    <span class="mi">0</span> <span class="mi">0</span>
</code></pre></div>

<ul>
<li>rootディレクトリを変更します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># arch-chroot /mnt</span>
<span class="err"># </span>
</code></pre></div>

<ul>
<li>現在の時刻表記を確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># date</span>
<span class="err">Sat Dec 11 07:59:54 UTC 2021</span>
</code></pre></div>

<ul>
<li>タイムゾーンを日本に設定します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime</span>
</code></pre></div>

<ul>
<li>タイムゾーンが日本に設定されたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># date</span>
<span class="err">Sat Dec 11 18:13:20 JST 2021</span>
</code></pre></div>

<ul>
<li>adjtimeファイルがないことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># ls /etc/adjtime</span>
<span class="c">ls: cannot access &#39;/etc/adjtime&#39;: No such file or directory</span>
</code></pre></div>

<ul>
<li>ハードウェア・クロックを現在のシステム・クロックに合わせます。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># hwclock --systohc</span>
</code></pre></div>

<ul>
<li>adjtimeファイルが作成されたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># ls /etc/adjtime</span>
<span class="err">/etc/adjtime</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err"># cat /etc/adjtime</span>
<span class="err">0.000000 1639209682 0.000000</span>
<span class="err">1639209682</span>
<span class="err">UTC</span>
</code></pre></div>

<ul>
<li>vimをインストールします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># pacman -S vim --noconfirm</span>
</code></pre></div>

<ul>
<li>ロケールの一覧から<code>en_US.UTF-8 UTF-8</code>をアンコメントします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># vim /etc/locale.gen</span>
</code></pre></div>

<ul>
<li>ロケールを生成します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># locale-gen </span>
<span class="err">Generating locales...</span>
<span class="err">  en_US.UTF-8... done</span>
<span class="err">Generation complete.</span>
</code></pre></div>

<ul>
<li>システム全体のロケールを設定します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># echo LANG=en_US.UTF-8 &gt; /etc/locale.conf</span>
</code></pre></div>

<ul>
<li>/etc/locale.confファイルが作成されたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># cat /etc/locale.conf </span>
<span class="err">LANG=en_US.UTF-8</span>
</code></pre></div>

<ul>
<li>日本語キーボードのレイアウトに変更します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># echo jp106  &gt; /etc/vconsole.conf</span>
</code></pre></div>

<ul>
<li>/etc/vconsole.confファイルが作成されたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># cat /etc/vconsole.conf </span>
<span class="err">jp106</span>
</code></pre></div>

<ul>
<li>ホスト名を設定します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># echo hoge.blackle0pard.local &gt; /etc/hostname</span>
</code></pre></div>

<ul>
<li>/etc/hostnameファイルが作成されたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># cat /etc/hostname </span>
<span class="err">hoge.blackle0pard.local</span>
</code></pre></div>

<ul>
<li>hostsファイルを修正します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># vim /etc/hosts</span>
</code></pre></div>

<ul>
<li>修正した内容を確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="k">Static</span> <span class="k">table</span> <span class="n">lookup</span> <span class="k">for</span> <span class="n">hostnames</span><span class="p">.</span>
<span class="o">#</span> <span class="n">See</span> <span class="n">hosts</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">for</span> <span class="n">details</span><span class="p">.</span>

<span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>       <span class="n">localhost</span>
<span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span>       <span class="n">hoge</span><span class="p">.</span><span class="n">blackle0pard</span><span class="p">.</span><span class="k">local</span> <span class="n">hoge</span>
</code></pre></div>

<ul>
<li>rootユーザーのパスワードを設定します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># passwd</span>
<span class="err">New password: </span>
<span class="err">Retype new password: </span>
<span class="c">passwd: password updated successfully</span>
</code></pre></div>

<ul>
<li>SSHログイン用ユーザーを作成します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># useradd -m hoge</span>
</code></pre></div>

<ul>
<li>作成したSSHログイン用ユーザーの情報を確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># id hoge</span>
<span class="err">uid=1000(hoge) gid=1000(hoge) groups=1000(hoge)</span>
</code></pre></div>

<ul>
<li>SSHログイン用ユーザーのパスワードを設定します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># passwd hoge</span>
<span class="err">New password: </span>
<span class="err">Retype new password: </span>
<span class="c">passwd: password updated successfully</span>
</code></pre></div>

<ul>
<li>systemd-networkdサービス(ネットワークの設定)の自動起動を有効化します。  </li>
<li><a href="https://wiki.archlinux.jp/index.php/Systemd-networkd">systemd-networkd - ArchWiki</a>  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># systemctl enable systemd-networkd</span>
</code></pre></div>

<ul>
<li>systemd-resolvedサービス(名前解決)の自動起動を有効化します。  </li>
<li><a href="https://wiki.archlinux.jp/index.php/Systemd-resolved">systemd-resolved - ArchWiki</a>  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># systemctl enable systemd-resolved</span>
</code></pre></div>

<ul>
<li>Public NetworkのNWインタフェースに対して、IPアドレスを設定します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># vim /etc/systemd/network/enp1s0.network</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">network</span><span class="o">/</span><span class="n">enp1s0</span><span class="p">.</span><span class="n">network</span><span class="w"></span>
<span class="o">[</span><span class="n">Match</span><span class="o">]</span><span class="w"></span>
<span class="n">Name</span><span class="o">=</span><span class="n">enp1s0</span><span class="w"></span>

<span class="o">[</span><span class="n">Network</span><span class="o">]</span><span class="w"></span>
<span class="n">Address</span><span class="o">=***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***/</span><span class="mi">23</span><span class="w"></span>
<span class="n">Gateway</span><span class="o">=***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***</span><span class="w"></span>
<span class="n">DNS</span><span class="o">=***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***</span><span class="w"></span>
<span class="n">LinkLocalAddressing</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">IPv6AcceptRA</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
</code></pre></div>

<ul>
<li>Private NetworkのNWインタフェースに対して、IPアドレスを設定します。</li>
<li>Private NetworkのMTUは1450が推奨値。  </li>
</ul>
<blockquote>
<p>We recommend configuring an MTU of 1450 on your private network. Using a larger MTU will result in poor performance.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="err"># vim /etc/systemd/network/enp6s0.network</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">network</span><span class="o">/</span><span class="n">enp6s0</span><span class="p">.</span><span class="n">network</span><span class="w"></span>
<span class="o">[</span><span class="n">Match</span><span class="o">]</span><span class="w"></span>
<span class="n">Name</span><span class="o">=</span><span class="n">enp6s0</span><span class="w"></span>

<span class="o">[</span><span class="n">Link</span><span class="o">]</span><span class="w"></span>
<span class="n">MTUBytes</span><span class="o">=</span><span class="mi">1450</span><span class="w"></span>

<span class="o">[</span><span class="n">Network</span><span class="o">]</span><span class="w"></span>
<span class="n">Address</span><span class="o">=***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***</span><span class="p">.</span><span class="o">***/</span><span class="mi">24</span><span class="w"></span>
<span class="n">LinkLocalAddressing</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
<span class="n">IPv6AcceptRA</span><span class="o">=</span><span class="k">no</span><span class="w"></span>
</code></pre></div>

<ul>
<li>opensshパッケージをインストールします。   </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># pacman -S openssh --noconfirm</span>
</code></pre></div>

<ul>
<li>SSHの自動起動を有効化します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># systemctl enable sshd</span>
</code></pre></div>

<ul>
<li>grubパッケージをインストールします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># pacman -S grub --noconfirm</span>
</code></pre></div>

<ul>
<li>GRUBをインストールします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># grub-install --target=i386-pc /dev/vda</span>
</code></pre></div>

<ul>
<li>GRUBの起動メニューを生成します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># grub-mkconfig -o /boot/grub/grub.cfg</span>
</code></pre></div>

<ul>
<li>chroot環境から抜けます。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># exit</span>
<span class="err">exit</span>
<span class="err">arch-chroot /mnt  5.09s user 1.74s system 0% cpu 28:19.37 total</span>
<span class="err"># </span>
</code></pre></div>

<ul>
<li>/mntディレクトリをアンマウントします。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># umount /mnt </span>
</code></pre></div>

<ul>
<li>/mntディレクトリがアンマウントされたことを確認します。  </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># df -h</span>
<span class="err">Filesystem      Size  Used Avail Use% Mounted on</span>
<span class="err">dev             452M     0  452M   0% /dev</span>
<span class="err">run             486M  166M  320M  35% /run</span>
<span class="err">/dev/sr0        851M  851M     0 100% /run/archiso/bootmnt</span>
<span class="err">cowspace        256M  4.1M  252M   2% /run/archiso/cowspace</span>
<span class="err">/dev/loop0      702M  702M     0 100% /run/archiso/airootfs</span>
<span class="err">airootfs        256M  4.1M  252M   2% /</span>
<span class="err">tmpfs           486M     0  486M   0% /dev/shm</span>
<span class="err">tmpfs           486M     0  486M   0% /tmp</span>
<span class="err">tmpfs           486M  2.2M  484M   1% /etc/pacman.d/gnupg</span>
<span class="err">tmpfs            98M     0   98M   0% /run/user/0</span>
</code></pre></div>

<ul>
<li>ISOイメージをアンマウントして、OSを再起動します(Vultrの管理コンソールから実行)。</li>
</ul>
<h1>確認</h1>
<ul>
<li>OSの再起動後に、SSH用ログインユーザーでSSHログイン出来ることを確認します。  </li>
<li>インストール後の環境確認</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="err"># uname -srvmo</span>
<span class="err">Linux 5.10.84-1-lts #1 SMP Wed, 08 Dec 2021 10:17:01 +0000 x86_64 GNU/Linux</span>
</code></pre></div>
</div>
<div class="tag">
  <span class="mgl-10">
    <a href="https://blackle0pard.net/tag/archlinux/"># ArchLinux</a>
    <a href="https://blackle0pard.net/tag/vultr/"># Vultr</a>
  </span>
</div>
    <section class="footer">
      <a href="https://twitter.com/blackle0pard_" target="_blank">Twitter</a> &middot;
      <a href="https://github.com/blackle0pard" target="_blank">GitHub</a><br>
      © 2017 <a href="https://blackle0pard.net/">くろひょうのぶろぐ</a>
    </section>
  </div>
</body>

</html>